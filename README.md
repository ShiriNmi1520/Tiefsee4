# tiefsee4

目前版本：TiefSee 4.0.0-bate.2

- 專案類型：C# WinForm(net 4.7.2)
- UI渲染方式：WebView2
- 開發語言：TypeScript 


> TiefSee是圖片檢視軟體。 4.0.0版全面改寫架構，程式UI界面全部以HTML、css、JavaScript渲染，可實現半透明視窗與AERO毛玻璃視窗。

![](https://cdn.discordapp.com/attachments/803673073621401633/917208044578951229/2021-12-06_07-56-44.jpg)

![](https://cdn.discordapp.com/attachments/803673073621401633/917208044847366223/2021-12-06_08-04-22.jpg)

![](https://cdn.discordapp.com/attachments/803673073621401633/917208044360830986/2021-12-06_07-53-54.jpg)


## 目前已知問題

### 1、無法使用觸控拖曳移動程式
此問題在同樣基於webview2開發的win11 Microsoft Teams也存在
推測原因是chromium把touch給完全攔截，導致調用Windows API移動視窗的函數無法順利生效
這問題大概只有微軟自己能解決吧

### 2、渲染清明上河圖會很吃力
tiefsee4使用createImageBitmap來對圖片進行高品質的縮小處理，一般的圖片甚至是大於100M的圖片，createImageBitmap都能在不影響使用體驗的情況下高速繪製高品質圖片圖片，唯讀清明上河圖計算速度相當慢，不確定是長寬比差太多導致的BUG，還是單純超過40000px的圖片就會難以負荷

### 3、啟動程式的速度偏慢
初始化webview2核心大約需要1秒，之後會嘗試讓程式常駐在背景，這樣就不需要這1秒的初始化成本
我用另一台灌win11筆電來測試，開啟幾乎是無延遲，可能是win11有優化webview2，直接讓他變成系統核心常駐在背景？

### 4、win7無法透明化背景
基本上無解

### 5、webview2的js跟C#溝通一次的成本大約是7ms
假設要讀取資料夾裡面所有檔案的修改日期，這個資料夾有1000個檔案
那麼用js跑1000次迴圈呼叫C#來處理的溝通成本就需要7000ms
必須直接把迴圈寫在C#裡面，這樣掃描一次資料夾就只需要一次溝通成本，也就是7ms
因為沒辦法把所有邏輯都使用js來撰寫，所以這個限制會導致專案的耦合性上升

